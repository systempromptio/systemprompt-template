<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Resource Hints -->
<link rel="preconnect" href="/files/fonts/" crossorigin>
<link rel="dns-prefetch" href="/files/fonts/">

<!-- Font Preloading - Critical fonts loaded early -->
<link rel="preload" as="font" href="/files/fonts/Zepto/Zepto.woff" type="font/woff" crossorigin>
<link rel="preload" as="font" href="/files/fonts/OpenSans/OpenSans-Regular.ttf" type="font/truetype" crossorigin>

<!-- Critical CSS - Inlined to prevent FOUC -->
<style>
/* Prevent flash of unstyled content */
:root {
  --color-bg: #0a0a0f;
  --color-surface: #12121a;
  --color-text: #e8e8ed;
  --color-text-secondary: #9898a6;
  --orange-500: #f97316;
  --orange-600: #ea580c;
}
html {
  background-color: var(--color-bg);
  color: var(--color-text);
}
body {
  margin: 0;
  font-family: "OpenSans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background-color: var(--color-bg);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
/* Hide content until styles load to prevent layout shift */
.header, .site-header {
  min-height: 64px;
}
/* Font-face for immediate availability */
@font-face {
  font-family: "Zepto";
  src: url("/files/fonts/Zepto/Zepto.woff") format("woff");
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: "OpenSans";
  src: url("/files/fonts/OpenSans/OpenSans-Regular.ttf") format("truetype");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}
</style>

<!-- Core Styles -->
<link rel="stylesheet" href="/css/core/variables.css">
<link rel="stylesheet" href="/css/core/fonts.css">
<link rel="stylesheet" href="/css/core/reset.css">
<link rel="stylesheet" href="/css/components/header.css">
<link rel="stylesheet" href="/css/components/footer.css">
<link rel="stylesheet" href="/css/components/mobile-menu.css">


  <!-- SEO Meta Tags -->
  <title>Docker Configuration | systemprompt.io Documentation</title>
  <meta name="description" content="Docker serves two purposes in SystemPrompt: running PostgreSQL locally and deploying your application to production." />
  <meta name="author" content="SystemPrompt Team" />
  <meta name="keywords" content="docker, containers, deployment, production, dockerfile, postgresql, local development" />
  <link rel="canonical" href="https://systemprompt.io/documentation/config/docker" />

  <!-- Open Graph -->
  <meta property="og:title" content="Docker Configuration" />
  <meta property="og:description" content="Docker serves two purposes in SystemPrompt: running PostgreSQL locally and deploying your application to production." />
  <meta property="og:image" content="/files/images/docs/config-docker.svg" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://systemprompt.io/documentation/config/docker" />
  <meta property="og:site_name" content="systemprompt.io" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@your_handle" />
  <meta name="twitter:creator" content="@your_handle" />
  <meta name="twitter:title" content="Docker Configuration" />
  <meta name="twitter:description" content="Docker serves two purposes in SystemPrompt: running PostgreSQL locally and deploying your application to production." />
  <meta name="twitter:image" content="/files/images/docs/config-docker.svg" />

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />

  <!-- Styles -->
  <link rel="stylesheet" href="/css/docs.css" />
  <link rel="stylesheet" href="/css/syntax-highlight.css" />

  <!-- Structured Data (JSON-LD) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "TechArticle",
    "headline": "Docker Configuration",
    "description": "Docker serves two purposes in SystemPrompt: running PostgreSQL locally and deploying your application to production.",
    "image": "/files/images/docs/config-docker.svg",
    "author": {
      "@type": "Organization",
      "name": "systemprompt.io"
    },
    "publisher": {
      "@type": "Organization",
      "name": "systemprompt.io",
      "logo": {
        "@type": "ImageObject",
        "url": "https://systemprompt.io/files/images/logo.png"
      }
    },
    "datePublished": "",
    "dateModified": "",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://systemprompt.io/documentation/config/docker"
    },
    "keywords": "docker, containers, deployment, production, dockerfile, postgresql, local development",
    "inLanguage": ""
  }
  </script>

  <!-- BreadcrumbList Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {"@type": "ListItem", "position": 1, "name": "Home", "item": "https://systemprompt.io"},
      {"@type": "ListItem", "position": 2, "name": "Documentation", "item": "https://systemprompt.io/documentation"},
      {"@type": "ListItem", "position": 3, "name": "Docker Configuration", "item": "https://systemprompt.io/documentation/config/docker"}
    ]
  }
  </script>
</head>
<body class="docs-body">
  <div class="docs-background"></div>

  <header class="site-header">
  <nav class="site-nav">
    <a href="/" class="logo-link">
      <img src="/files/images/logo.svg" alt="systemprompt.io" class="logo-svg" />
    </a>
    <button class="mobile-menu-toggle" aria-label="Toggle navigation" aria-expanded="false">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>
    <div class="nav-links">
      <div class="nav-dropdown">
        <a href="/documentation" class="nav-dropdown-trigger">
          Documentation
          <svg class="dropdown-arrow" viewBox="0 0 12 12" width="12" height="12">
            <path d="M2 4l4 4 4-4" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>
        <div class="nav-dropdown-menu">
          <div class="dropdown-section">
            <h4>Getting Started</h4>
            <a href="/documentation">Overview</a>
            <a href="/documentation/installation">Installation</a>
            <a href="/documentation/playbooks">Playbooks</a>
          </div>
          <div class="dropdown-section">
            <h4>Configuration</h4>
            <a href="/documentation/config">Config</a>
            <a href="/documentation/services">Services</a>
            <a href="/documentation/extensions">Extensions</a>
          </div>
          <a href="/documentation" class="dropdown-view-all">View all documentation &rarr;</a>
        </div>
      </div>
      <div class="nav-dropdown">
        <a href="/blog" class="nav-dropdown-trigger">
          Blog
          <svg class="dropdown-arrow" viewBox="0 0 12 12" width="12" height="12">
            <path d="M2 4l4 4 4-4" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>
        <div class="nav-dropdown-menu">
          <div class="dropdown-section">
            <h4>Categories</h4>
            <a href="/blog">All Posts</a>
            <a href="/blog?category&#x3D;announcement">Announcements</a>
            <a href="/blog?category&#x3D;article">Articles</a>
            <a href="/blog?category&#x3D;guide">Guides</a>
          </div>
        </div>
      </div>
      <div class="nav-dropdown">
        <a href="/playbooks" class="nav-dropdown-trigger">
          Playbooks
          <svg class="dropdown-arrow" viewBox="0 0 12 12" width="12" height="12">
            <path d="M2 4l4 4 4-4" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>
        <div class="nav-dropdown-menu">
          <div class="dropdown-section">
            <h4>Categories</h4>
            <a href="/playbooks">All Playbooks</a>
            <a href="/playbooks?category&#x3D;guide">Guides</a>
            <a href="/playbooks?category&#x3D;cli">CLI</a>
            <a href="/playbooks?category&#x3D;build">Build</a>
            <a href="/playbooks?category&#x3D;content">Content</a>
          </div>
        </div>
      </div>
      <a href="/documentation/installation" class="cta-button">Get Started</a>
    </div>
  </nav>
</header>


  <div class="docs-layout">
    <!-- Left Sidebar - Navigation (dynamically rendered from config.yaml) -->
    <aside class="docs-sidebar">
      <nav class="docs-nav" aria-label="Documentation navigation">
        <div class="docs-nav-section">
          <h3 class="docs-nav-title">Getting Started</h3>
          <ul class="docs-nav-list">
            <li><a href="/documentation" class="docs-nav-link">Overview</a></li>
            <li><a href="/documentation/installation" class="docs-nav-link">Installation</a></li>
            <li><a href="/documentation/licensing" class="docs-nav-link">Licensing</a></li>
            <li><a href="/documentation/playbooks" class="docs-nav-link">Playbooks</a></li>
          </ul>
        </div>
        <div class="docs-nav-section">
          <h3 class="docs-nav-title">Config</h3>
          <ul class="docs-nav-list">
            <li><a href="/documentation/config" class="docs-nav-link">Overview</a></li>
            <li><a href="/documentation/config/database" class="docs-nav-link">Database</a></li>
            <li><a href="/documentation/config/deployment" class="docs-nav-link">Deployment</a></li>
            <li><a href="/documentation/config/docker" class="docs-nav-link">Docker</a></li>
            <li><a href="/documentation/config/domains" class="docs-nav-link">Domains</a></li>
            <li><a href="/documentation/config/profiles" class="docs-nav-link">Profiles</a></li>
            <li><a href="/documentation/config/secrets" class="docs-nav-link">Secrets</a></li>
            <li><a href="/documentation/config/sessions" class="docs-nav-link">Sessions</a></li>
            <li><a href="/documentation/config/sync" class="docs-nav-link">Sync</a></li>
            <li><a href="/documentation/config/tenants" class="docs-nav-link">Tenants</a></li>
          </ul>
        </div>
        <div class="docs-nav-section">
          <h3 class="docs-nav-title">Services</h3>
          <ul class="docs-nav-list">
            <li><a href="/documentation/services" class="docs-nav-link">Overview</a></li>
            <li><a href="/documentation/services/agents" class="docs-nav-link">Agents</a></li>
            <li><a href="/documentation/services/ai" class="docs-nav-link">AI</a></li>
            <li><a href="/documentation/services/analytics" class="docs-nav-link">Analytics</a></li>
            <li><a href="/documentation/services/auth" class="docs-nav-link">Auth</a></li>
            <li><a href="/documentation/services/config" class="docs-nav-link">Config</a></li>
            <li><a href="/documentation/services/content" class="docs-nav-link">Content</a></li>
            <li><a href="/documentation/services/files" class="docs-nav-link">Files</a></li>
            <li><a href="/documentation/services/mcp" class="docs-nav-link">MCP</a></li>
            <li><a href="/documentation/services/playbooks" class="docs-nav-link">Playbooks</a></li>
            <li><a href="/documentation/services/scheduler" class="docs-nav-link">Scheduler</a></li>
            <li><a href="/documentation/services/skills" class="docs-nav-link">Skills</a></li>
            <li><a href="/documentation/services/users" class="docs-nav-link">Users</a></li>
            <li><a href="/documentation/services/web" class="docs-nav-link">Web</a></li>
            <li><a href="/documentation/services/workflows" class="docs-nav-link">Workflows</a></li>
          </ul>
        </div>
        <div class="docs-nav-section">
          <h3 class="docs-nav-title">Extensions</h3>
          <ul class="docs-nav-list">
            <li><a href="/documentation/extensions" class="docs-nav-link">Overview</a></li>
            <li><a href="/documentation/extensions/template" class="docs-nav-link">Template Architecture</a></li>
            <li><a href="/documentation/extensions/hooks" class="docs-nav-link">Lifecycle Hooks</a></li>
            <li><a href="/documentation/extensions/rust" class="docs-nav-link">Library Extensions</a></li>
            <li><a href="/documentation/extensions/web" class="docs-nav-link">Web Extensions</a></li>
            <li><a href="/documentation/extensions/page-data-providers" class="docs-nav-link">Page Data Providers</a></li>
            <li><a href="/documentation/extensions/component-renderers" class="docs-nav-link">Component Renderers</a></li>
            <li><a href="/documentation/extensions/jobs" class="docs-nav-link">Background Jobs</a></li>
            <li><a href="/documentation/extensions/mcp" class="docs-nav-link">MCP Extensions</a></li>
            <li><a href="/documentation/extensions/cli" class="docs-nav-link">CLI Extensions</a></li>
          </ul>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="docs-main">
      <nav class="breadcrumb" aria-label="Breadcrumb">
        <a href="/">Home</a>
        <span class="breadcrumb__separator">/</span>
        <a href="/documentation">Documentation</a>
        <span class="breadcrumb__separator">/</span>
        <span class="breadcrumb__current">Docker Configuration</span>
      </nav>

      <article class="docs-article">
        <header class="docs-header">
          <div class="docs-title-row">
            <h1>Docker Configuration</h1>
            <button class="docs-export-btn" data-slug="config/docker" aria-label="Copy as Markdown" title="Copy as Markdown">
              <svg class="copy-icon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"/>
                <path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/>
              </svg>
              <svg class="check-icon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.75.75 0 1 1 1.06-1.06L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/>
              </svg>
            </button>
          </div>
          <p class="docs-description">Docker serves two purposes in SystemPrompt: running PostgreSQL locally and deploying your application to production.</p>
          <div class="docs-meta">
            <time datetime="">Last updated: </time>
          </div>
        </header>

        <!-- Learning Objectives - Top Callout -->

        <!-- Mobile Table of Contents (shown ≤1200px) -->
        <div class="docs-toc-mobile">
          <details class="toc-mobile-details">
            <summary class="toc-mobile-summary">
              <span class="toc-mobile-label">On this page</span>
              <svg class="toc-mobile-chevron" viewBox="0 0 12 12" width="12" height="12" fill="none" stroke="currentColor">
                <path d="M2 4l4 4 4-4" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </summary>
            <nav class="toc-mobile-nav" aria-label="Table of contents">
              <div class="toc-content toc-content--mobile">
                <ul class="toc-list">
<li class="toc-item toc-level-2">
<a class="toc-link" href="#postgresql-containers">PostgreSQL Containers</a>
<ul class="toc-list toc-nested">
<li class="toc-item toc-level-3">
<a class="toc-link" href="#shared-postgresql">Shared PostgreSQL</a>
</li>
<li class="toc-item toc-level-3">
<a class="toc-link" href="#tenant-specific-postgresql">Tenant-Specific PostgreSQL</a>
</li>
</ul>
<li class="toc-item toc-level-2">
<a class="toc-link" href="#application-deployment">Application Deployment</a>
<ul class="toc-list toc-nested">
<li class="toc-item toc-level-3">
<a class="toc-link" href="#profile-dockerfiles">Profile Dockerfiles</a>
</li>
<li class="toc-item toc-level-3">
<a class="toc-link" href="#entrypoint-scripts">Entrypoint Scripts</a>
</li>
<li class="toc-item toc-level-3">
<a class="toc-link" href="#building-images-locally">Building Images Locally</a>
</li>
<li class="toc-item toc-level-3">
<a class="toc-link" href="#cloud-deployment">Cloud Deployment</a>
</li>
</ul>
<li class="toc-item toc-level-2">
<a class="toc-link" href="#environment-variables">Environment Variables</a>
</li>
<li class="toc-item toc-level-2">
<a class="toc-link" href="#docker-compose-for-development">Docker Compose for Development</a>
</li>
<li class="toc-item toc-level-2">
<a class="toc-link" href="#production-considerations">Production Considerations</a>
<ul class="toc-list toc-nested">
<li class="toc-item toc-level-3">
<a class="toc-link" href="#multi-stage-builds">Multi-stage Builds</a>
</li>
<li class="toc-item toc-level-3">
<a class="toc-link" href="#health-checks">Health Checks</a>
</li>
<li class="toc-item toc-level-3">
<a class="toc-link" href="#secrets-management">Secrets Management</a>
</li>
</ul>
<li class="toc-item toc-level-2">
<a class="toc-link" href="#directory-structure">Directory Structure</a>
</li>
<li class="toc-item toc-level-2">
<a class="toc-link" href="#quick-reference">Quick Reference</a>
</li>
</ul>

              </div>


            </nav>
          </details>
        </div>

        <div class="docs-content">
          <p>Docker serves two distinct purposes in SystemPrompt: running PostgreSQL for local development and deploying your application to production. Understanding which Docker files to use and when is essential for a smooth development workflow.</p>
<h2 id="postgresql-containers">PostgreSQL Containers</h2>
<p>SystemPrompt uses Docker to run PostgreSQL locally. You have two options depending on your setup: a shared container for multiple projects, or tenant-specific containers for isolated development.</p>
<h3 id="shared-postgresql">Shared PostgreSQL</h3>
<p>The shared PostgreSQL container allows multiple SystemPrompt projects to share a single database server. This is efficient when you're working on several projects simultaneously and want to minimize resource usage.</p>
<p>The configuration lives in <code>.systemprompt/docker/shared.yaml</code>. When you run <code>just db-up</code>, this container starts and exposes PostgreSQL on port 5432. A companion file, <code>shared_config.json</code>, tracks which tenant databases exist within this shared server.</p>
<pre><code class="language-bash"># Start shared PostgreSQL
just db-up

# Stop shared PostgreSQL
just db-down

# Reset shared PostgreSQL (removes all data)
just db-reset

# View PostgreSQL logs
just db-logs

# List all tenant databases in shared server
just db-list
</code></pre>
<p>Each tenant gets its own database within the shared server. When you create a new local tenant with <code>systemprompt cloud tenant create</code>, it automatically registers a database in the shared configuration. Your profile's <code>DATABASE_URL</code> in <code>secrets.json</code> points to this specific database.</p>
<h3 id="tenant-specific-postgresql">Tenant-Specific PostgreSQL</h3>
<p>For isolated development, each tenant can have its own dedicated PostgreSQL container. This is useful when you need different PostgreSQL versions or configurations per project, or when you want complete isolation between environments.</p>
<p>Tenant-specific configurations are generated automatically in <code>.systemprompt/docker/{TENANT_NAME}.yaml</code> when you create a tenant. Each container uses a named volume to persist data across restarts.</p>
<pre><code class="language-bash"># Start a specific tenant's PostgreSQL
just db-up TENANT=&quot;my-project&quot;

# Stop a specific tenant's PostgreSQL
just db-down TENANT=&quot;my-project&quot;
</code></pre>
<p>The tenant-specific approach uses more resources but provides complete isolation. Changes to one project's database cannot affect another.</p>
<h2 id="application-deployment">Application Deployment</h2>
<p>Beyond database containers, Docker is used to package your SystemPrompt application for deployment. Profile-specific Dockerfiles define how your application is built and run in production.</p>
<h3 id="profile-dockerfiles">Profile Dockerfiles</h3>
<p>Each profile can include its own Dockerfile in <code>.systemprompt/profiles/{profile-name}/docker/</code>. This allows different deployment configurations for development versus production.</p>
<p>A local profile Dockerfile might include debugging tools and skip certain optimizations. A production profile Dockerfile focuses on minimal image size, security hardening, and proper health checks.</p>
<p>The Dockerfile structure follows a consistent pattern:</p>
<pre><code class="language-dockerfile">FROM debian:bookworm-slim

RUN apt-get update &amp;&amp; apt-get install -y \
    ca-certificates libssl3 \
    &amp;&amp; rm -rf /var/lib/apt/lists/*

WORKDIR /app
COPY target/release/systemprompt /app/bin/
COPY services/ /app/services/
COPY web/ /app/web/

ENV HOST=0.0.0.0 PORT=8080
EXPOSE 8080
CMD [&quot;/app/bin/systemprompt&quot;, &quot;infra&quot;, &quot;services&quot;, &quot;start&quot;, &quot;--all&quot;]
</code></pre>
<h3 id="entrypoint-scripts">Entrypoint Scripts</h3>
<p>Each profile includes an <code>entrypoint.sh</code> script that runs before your application starts. This typically handles database migrations and any pre-flight checks:</p>
<pre><code class="language-bash">#!/bin/sh
set -e
echo &quot;Running database migrations...&quot;
/app/bin/systemprompt infra db migrate
echo &quot;Starting services...&quot;
exec /app/bin/systemprompt infra services serve --foreground
</code></pre>
<p>The entrypoint ensures your database schema is up-to-date before the application accepts traffic.</p>
<h3 id="building-images-locally">Building Images Locally</h3>
<p>Test your Docker build locally before deploying to production:</p>
<pre><code class="language-bash"># Build the release binary first
cargo build --release -p systemprompt-cli

# Build MCP servers if using them
just build-mcp

# Build Docker image
just docker-build local

# Run the image locally
just docker-run local
</code></pre>
<p>This workflow validates that your Dockerfile works correctly and your application starts as expected.</p>
<h3 id="cloud-deployment">Cloud Deployment</h3>
<p>When you run <code>just deploy</code>, the CLI orchestrates the full deployment workflow:</p>
<ol>
<li>Builds the Rust binary with release optimizations</li>
<li>Builds any MCP servers your application uses</li>
<li>Uses the active profile's Dockerfile to build an image</li>
<li>Pushes the image to the container registry</li>
<li>Deploys to your cloud tenant</li>
</ol>
<pre><code class="language-bash"># Full deployment workflow
just deploy

# Deploy a specific profile
systemprompt cloud deploy --profile production --yes

# Redeploy without rebuilding (uses existing image)
systemprompt cloud deploy --profile production --yes --skip-push
</code></pre>
<p>The deployment process respects your profile's Dockerfile, ensuring environment-specific configurations are correctly applied.</p>
<h2 id="environment-variables">Environment Variables</h2>
<p>Docker containers receive configuration through environment variables. These override defaults and connect your application to external services.</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DATABASE_URL</code></td>
<td>PostgreSQL connection string</td>
<td>Yes</td>
</tr>
<tr>
<td><code>HOST</code></td>
<td>Bind address (default: 0.0.0.0)</td>
<td>No</td>
</tr>
<tr>
<td><code>PORT</code></td>
<td>Server port (default: 8080)</td>
<td>No</td>
</tr>
<tr>
<td><code>RUST_LOG</code></td>
<td>Log level (info, debug, trace)</td>
<td>No</td>
</tr>
<tr>
<td><code>SYSTEMPROMPT_PROFILE</code></td>
<td>Path to active profile</td>
<td>No</td>
</tr>
<tr>
<td><code>SYSTEMPROMPT_SERVICES_PATH</code></td>
<td>Path to services directory</td>
<td>No</td>
</tr>
</tbody>
</table>
<p>Pass environment variables when running containers:</p>
<pre><code class="language-bash">docker run -p 8080:8080 \
  -e DATABASE_URL=&quot;postgres://user:pass@host:5432/db&quot; \
  -e RUST_LOG=&quot;info&quot; \
  myproject:latest
</code></pre>
<h2 id="docker-compose-for-development">Docker Compose for Development</h2>
<p>For local development with both the application and PostgreSQL, use Docker Compose:</p>
<pre><code class="language-yaml"># docker-compose.yaml
services:
  app:
    build: .
    ports:
      - &quot;8080:8080&quot;
    environment:
      DATABASE_URL: postgres://systemprompt:localdev@postgres:5432/systemprompt
    depends_on:
      - postgres

  postgres:
    image: postgres:18-alpine
    environment:
      POSTGRES_USER: systemprompt
      POSTGRES_PASSWORD: localdev
      POSTGRES_DB: systemprompt
    volumes:
      - pgdata:/var/lib/postgresql

volumes:
  pgdata:
</code></pre>
<pre><code class="language-bash">docker compose up -d
</code></pre>
<p>This approach bundles everything needed to run your application in a single command.</p>
<h2 id="production-considerations">Production Considerations</h2>
<h3 id="multi-stage-builds">Multi-stage Builds</h3>
<p>Reduce image size with multi-stage builds that separate compilation from runtime:</p>
<pre><code class="language-dockerfile"># Build stage
FROM rust:1.75 as builder
WORKDIR /app
COPY . .
RUN cargo build --release -p systemprompt-cli

# Runtime stage
FROM debian:bookworm-slim
RUN apt-get update &amp;&amp; apt-get install -y ca-certificates libssl3 \
    &amp;&amp; rm -rf /var/lib/apt/lists/*
WORKDIR /app
COPY --from=builder /app/target/release/systemprompt /app/bin/
COPY services/ /app/services/
COPY web/ /app/web/
ENV HOST=0.0.0.0 PORT=8080
EXPOSE 8080
CMD [&quot;/app/bin/systemprompt&quot;, &quot;infra&quot;, &quot;services&quot;, &quot;start&quot;, &quot;--all&quot;]
</code></pre>
<h3 id="health-checks">Health Checks</h3>
<p>Add health checks so orchestrators can detect unhealthy containers:</p>
<pre><code class="language-dockerfile">HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:8080/api/v1/health || exit 1
</code></pre>
<h3 id="secrets-management">Secrets Management</h3>
<p>Never bake secrets into Docker images. Pass them at runtime through environment variables or a secrets manager:</p>
<pre><code class="language-bash"># Environment variable (simple)
docker run -e DATABASE_URL=&quot;$DATABASE_URL&quot; myproject:latest

# Docker secrets (Swarm mode)
docker secret create db_url ./db_url.txt
docker service create --secret db_url myproject:latest
</code></pre>
<h2 id="directory-structure">Directory Structure</h2>
<p>Docker-related files are organized within <code>.systemprompt/</code>:</p>
<pre><code>.systemprompt/
├── Dockerfile                    # Template for local testing
├── .dockerignore                 # Files excluded from build context
├── entrypoint.sh                 # Root entrypoint script
├── docker/
│   ├── shared.yaml              # Shared PostgreSQL container
│   ├── shared_config.json       # Tracks databases in shared server
│   └── {TENANT}.yaml            # Tenant-specific PostgreSQL
└── profiles/
    ├── local/
    │   └── docker/
    │       ├── Dockerfile       # Local profile build
    │       ├── Dockerfile.dockerignore
    │       └── entrypoint.sh
    └── production/
        └── docker/
            ├── Dockerfile       # Production profile build
            ├── Dockerfile.dockerignore
            └── entrypoint.sh
</code></pre>
<h2 id="quick-reference">Quick Reference</h2>
<table>
<thead>
<tr>
<th>Task</th>
<th>Command</th>
</tr>
</thead>
<tbody>
<tr>
<td>Start shared PostgreSQL</td>
<td><code>just db-up</code></td>
</tr>
<tr>
<td>Stop shared PostgreSQL</td>
<td><code>just db-down</code></td>
</tr>
<tr>
<td>Reset shared PostgreSQL</td>
<td><code>just db-reset</code></td>
</tr>
<tr>
<td>View PostgreSQL logs</td>
<td><code>just db-logs</code></td>
</tr>
<tr>
<td>Start tenant PostgreSQL</td>
<td><code>just db-up TENANT=&quot;name&quot;</code></td>
</tr>
<tr>
<td>Build Docker image</td>
<td><code>just docker-build local</code></td>
</tr>
<tr>
<td>Run Docker image</td>
<td><code>just docker-run local</code></td>
</tr>
<tr>
<td>Deploy to cloud</td>
<td><code>just deploy</code></td>
</tr>
<tr>
<td>View profile Dockerfile</td>
<td><code>systemprompt cloud dockerfile</code></td>
</tr>
</tbody>
</table>

        </div>

      </article>
    </main>

    <!-- Right Sidebar - Table of Contents & Related Links -->
    <aside class="docs-toc">
      <nav class="toc-nav" aria-label="Table of contents">
        <h3 class="toc-title">On this page</h3>
        <div class="toc-content">
          <ul class="toc-list">
<li class="toc-item toc-level-2">
<a class="toc-link" href="#postgresql-containers">PostgreSQL Containers</a>
<ul class="toc-list toc-nested">
<li class="toc-item toc-level-3">
<a class="toc-link" href="#shared-postgresql">Shared PostgreSQL</a>
</li>
<li class="toc-item toc-level-3">
<a class="toc-link" href="#tenant-specific-postgresql">Tenant-Specific PostgreSQL</a>
</li>
</ul>
<li class="toc-item toc-level-2">
<a class="toc-link" href="#application-deployment">Application Deployment</a>
<ul class="toc-list toc-nested">
<li class="toc-item toc-level-3">
<a class="toc-link" href="#profile-dockerfiles">Profile Dockerfiles</a>
</li>
<li class="toc-item toc-level-3">
<a class="toc-link" href="#entrypoint-scripts">Entrypoint Scripts</a>
</li>
<li class="toc-item toc-level-3">
<a class="toc-link" href="#building-images-locally">Building Images Locally</a>
</li>
<li class="toc-item toc-level-3">
<a class="toc-link" href="#cloud-deployment">Cloud Deployment</a>
</li>
</ul>
<li class="toc-item toc-level-2">
<a class="toc-link" href="#environment-variables">Environment Variables</a>
</li>
<li class="toc-item toc-level-2">
<a class="toc-link" href="#docker-compose-for-development">Docker Compose for Development</a>
</li>
<li class="toc-item toc-level-2">
<a class="toc-link" href="#production-considerations">Production Considerations</a>
<ul class="toc-list toc-nested">
<li class="toc-item toc-level-3">
<a class="toc-link" href="#multi-stage-builds">Multi-stage Builds</a>
</li>
<li class="toc-item toc-level-3">
<a class="toc-link" href="#health-checks">Health Checks</a>
</li>
<li class="toc-item toc-level-3">
<a class="toc-link" href="#secrets-management">Secrets Management</a>
</li>
</ul>
<li class="toc-item toc-level-2">
<a class="toc-link" href="#directory-structure">Directory Structure</a>
</li>
<li class="toc-item toc-level-2">
<a class="toc-link" href="#quick-reference">Quick Reference</a>
</li>
</ul>

        </div>
      </nav>


    </aside>
  </div>

  <footer class="site-footer">
  <div class="container">
    <div class="footer-grid">
      <div class="footer-brand">
        <div class="footer-logo">
          <img src="/files/images/logo.svg" alt="systemprompt.io" class="logo-svg" />
        </div>
        <p></p>
      </div>
      <div class="footer-links">
        <h4>Product</h4>
        <a href="/documentation">Documentation</a>
        <a href="/blog">Blog</a>
        <a href="/playbooks">Playbooks</a>
        <a href="https://github.com/systempromptio/systemprompt-template">Get Started</a>
        <a href="/sitemap.xml">Sitemap</a>
        <a href="/llms.txt">llms.txt</a>
      </div>
      <div class="footer-links">
        <h4>Features</h4>
        <a href="/features/agentic-mesh">Agentic Mesh</a>
        <a href="/features/self-hosted-ai-platform">Embedded AI Library</a>
        <a href="/features/unified-control-plane">Unified Control Plane</a>
        <a href="/features/closed-loop-agents">The Closed Loop</a>
      </div>
      <div class="footer-links">
        <h4>Legal</h4>
        <a href="/legal/privacy-policy">Privacy Policy</a>
        <a href="/legal/cookie-policy">Cookie Policy</a>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2025 Your Company. All rights reserved.</p>
    </div>
  </div>
</footer>


  <!-- Scripts -->
  <script src="/js/docs.js"></script>
  <!-- Analytics -->
<script src="/files/js/analytics.js" defer></script>
<!-- Mobile Menu Toggle -->
<script src="/js/mobile-menu.js" defer></script>

</body>
</html>
