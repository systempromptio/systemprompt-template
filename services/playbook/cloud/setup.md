---
title: "Environment Setup Playbook"
description: "Configuring databases, credentials, and secrets across environments."
keywords:
  - setup
  - environment
  - database
  - secrets
---

# Environment Setup Guide

Complete guide for configuring databases, credentials, and secrets across environments.

> **Help**: `{ "command": "playbook cloud" }` via `systemprompt_help`

---

## Quick Start

```bash
# Terminal commands
just login   # Authenticate with SystemPrompt Cloud
just setup   # Link project to a tenant
just config  # Configure environment (creates profile, secrets, database)
```

---

## Configuration Components

Each environment requires three components:

| Component | Format | Contains | Location |
|-----------|--------|----------|----------|
| **Profile** | YAML | All config (db, server, paths, security) | `.systemprompt/profiles/{env}.profile.yml` |
| **Secrets** | JSON | API keys (Gemini, Anthropic, OpenAI) | `.systemprompt/profiles/{env}/secrets.json` |
| **Credentials** | JSON | Cloud auth (API token, tenant ID) | `.systemprompt/credentials.json` |

### Profile

The master configuration file. Contains everything needed to run the application.

```yaml
name: local
database:
  url: postgres://user:pass@localhost:5432/mydb
server:
  port: 8080
  api_external_url: http://localhost:8080
security:
  jwt_secret: <32+ characters>
secrets:
  secrets_path: ../secrets.json
cloud:
  credentials_path: ../credentials.json
  enabled: false
  validation: skip
```

### Secrets

API keys for AI providers. Separate from profile for security.

```json
{
  "gemini": "AIzaSy...",
  "anthropic": "sk-ant-...",
  "openai": "sk-..."
}
```

### Credentials

Cloud authentication tokens. Generated by `systemprompt cloud login`.

```json
{
  "api_token": "eyJhbG...",
  "api_url": "https://api.systemprompt.io",
  "tenant_id": "tenant_123",
  "app_id": "app_456",
  "hostname": "myapp.systemprompt.io"
}
```

---

## Setup Commands

### Step 1: Cloud Login

```json
// MCP: systemprompt
{ "command": "cloud auth login" }
```

Opens browser for GitHub/Google OAuth and saves credentials.

### Step 2: Cloud Setup

```json
// MCP: systemprompt
{ "command": "cloud tenant create --name my-project --region iad" }
```

Links project to a cloud tenant.

### Step 3: Configure

```json
// MCP: systemprompt
{ "command": "cloud profile create local" }
```

Interactive wizard for complete environment setup.

### Step 4: Database Setup

```bash
# Terminal
just db-up        # Start PostgreSQL
just db-migrate   # Run migrations
```

### Step 5: Verify

```json
// MCP: systemprompt
{ "command": "cloud status" }
```

---

## Per-Environment Setup

### Development (local)

```bash
export SYSTEMPROMPT_PROFILE=.systemprompt/profiles/local/profile.yml
just up      # Start PostgreSQL
just start   # Run server
```

### Production

```bash
export SYSTEMPROMPT_PROFILE=.systemprompt/profiles/production/profile.yml
just deploy  # Build and deploy
```

**Fly.io secrets (set via `fly secrets set`):**
```bash
fly secrets set \
  GEMINI_API_KEY="..." \
  ANTHROPIC_API_KEY="..." \
  SYSTEMPROMPT_API_TOKEN="..." \
  SYSTEMPROMPT_TENANT_ID="..."
```

---

## Just Commands

| Command | Purpose |
|---------|---------|
| `just login` | Authenticate with OAuth |
| `just logout` | Clear credentials |
| `just status` | Check auth and tenant status |
| `just setup` | Link project to tenant |
| `just config` | Interactive config wizard |
| `just show` | Display configuration |
| `just up` | Start PostgreSQL |
| `just down` | Stop PostgreSQL |
| `just migrate` | Run database migrations |
| `just reset` | Reset database |
| `just start` | Start server |
| `just deploy` | Build and deploy |
| `just dev` | up + migrate + start |
| `just fresh` | reset + migrate + start |

---

## Common Workflows

### New Project Setup

```bash
git clone https://github.com/systemprompt/template my-project
cd my-project
git submodule update --init --recursive
just login
just setup --name my-project
just config
just dev
```

### Adding a New Environment

```bash
cp .systemprompt/profiles/local/profile.yml .systemprompt/profiles/staging/profile.yml
$EDITOR .systemprompt/profiles/staging/profile.yml
just login
just setup --name staging
```

### Deploy to Production

```bash
export SYSTEMPROMPT_PROFILE=.systemprompt/profiles/production/profile.yml
just deploy
fly ssh console -C "systemprompt db migrate"
```

---

## Troubleshooting

### Profile Not Found

```
Profile initialization failed. Set SYSTEMPROMPT_PROFILE environment variable
```

**Fix:**
```bash
export SYSTEMPROMPT_PROFILE=/absolute/path/to/profile.yml
```

### Secrets File Not Found

```
Secrets file not found: ./secrets.json
```

**Fix:** Create secrets file or set validation to skip in profile.

### Cloud Token Expired

```
Cloud token has expired. Run 'systemprompt cloud login' to refresh
```

**Fix:** `just login`

### Database Connection Failed

**Fix:** `just up` then verify with `docker ps | grep postgres`

### JWT Secret Too Short

**Fix:** Generate a longer secret:
```bash
openssl rand -base64 48
```

---

## File Structure

```
.systemprompt/
├── profiles/
│   ├── local/
│   │   ├── profile.yml
│   │   ├── secrets.json
│   │   └── docker-compose.yml
│   └── production/
│       ├── profile.yml
│       └── secrets.json
├── credentials.json
└── tenants.json
```

**All files in `.systemprompt/` are gitignored.**

---

## Security Notes

1. **Never commit secrets** -- All `.systemprompt/` files are gitignored
2. **File permissions** -- Secrets files created with `0o600`
3. **JWT secret length** -- Minimum 32 characters enforced
4. **Fly.io secrets** -- Use `fly secrets set` for production
5. **Token expiration** -- Cloud credentials validated on load

---

## Quick Reference

| Task | Command |
|------|---------|
| Login | `just login` |
| Setup | `just setup --name <name>` |
| Configure | `just config` |
| Start DB | `just db-up` |
| Migrate | `just migrate` |
| Start server | `just start` |
| Deploy | `just deploy` |
| Full dev | `just dev` |
