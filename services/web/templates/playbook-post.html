<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  {{{HEAD_ASSETS}}}

  <!-- SEO Meta Tags -->
  <title>{{TITLE}} | {{ORG_NAME}}</title>
  <meta name="description" content="{{DESCRIPTION}}" />
  <meta name="author" content="{{AUTHOR}}" />
  <meta name="keywords" content="{{KEYWORDS}}" />
  <link rel="canonical" href="{{ORG_URL}}/playbooks/{{SLUG}}" />

  <!-- Open Graph -->
  <meta property="og:title" content="{{TITLE}}" />
  <meta property="og:description" content="{{DESCRIPTION}}" />
  <meta property="og:image" content="{{ORG_LOGO}}" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="{{ORG_URL}}/playbooks/{{SLUG}}" />
  <meta property="og:site_name" content="{{ORG_NAME}}" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="{{TWITTER_HANDLE}}" />
  <meta name="twitter:title" content="{{TITLE}}" />
  <meta name="twitter:description" content="{{DESCRIPTION}}" />

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />

  <!-- Styles -->
  <link rel="stylesheet" href="/css/playbook.css" />
  <link rel="stylesheet" href="/css/syntax-highlight.css" />

  <!-- Structured Data (JSON-LD) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "TechArticle",
    "headline": "{{TITLE}}",
    "description": "{{DESCRIPTION}}",
    "author": {
      "@type": "Organization",
      "name": "{{ORG_NAME}}"
    },
    "publisher": {
      "@type": "Organization",
      "name": "{{ORG_NAME}}",
      "logo": {
        "@type": "ImageObject",
        "url": "{{ORG_LOGO}}"
      }
    },
    "datePublished": "{{DATE_ISO}}",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "{{ORG_URL}}/playbooks/{{SLUG}}"
    },
    "keywords": "{{KEYWORDS}}",
    "inLanguage": "en"
  }
  </script>

  <!-- BreadcrumbList Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {"@type": "ListItem", "position": 1, "name": "Home", "item": "{{ORG_URL}}"},
      {"@type": "ListItem", "position": 2, "name": "Playbooks", "item": "{{ORG_URL}}/playbooks"},
      {"@type": "ListItem", "position": 3, "name": "{{TITLE}}", "item": "{{ORG_URL}}/playbooks/{{SLUG}}"}
    ]
  }
  </script>
</head>
<body>
  <div class="playbook-background"></div>
  <div class="playbook-shape-left"></div>

  {{{HEADER}}}

  <main class="playbook-post">
    <nav class="breadcrumb" aria-label="Breadcrumb">
      <a href="/">Home</a>
      <span class="breadcrumb__separator">/</span>
      <a href="/playbooks">Playbooks</a>
      <span class="breadcrumb__separator">/</span>
      <span class="breadcrumb__current">{{TITLE}}</span>
    </nav>

    <article>
      <header class="post-header">
        <div class="post-title-row">
          <h1>{{TITLE}}</h1>
          <button class="playbook-copy-btn" aria-label="Copy as Markdown" title="Copy as Markdown">
            <svg class="copy-icon" viewBox="0 0 16 16" width="18" height="18" fill="currentColor">
              <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"/>
              <path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/>
            </svg>
            <svg class="check-icon" viewBox="0 0 16 16" width="18" height="18" fill="currentColor">
              <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.75.75 0 1 1 1.06-1.06L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/>
            </svg>
          </button>
        </div>
        {{#if PRIORITY}}
        <span class="playbook-priority playbook-priority--{{PRIORITY}}">
          {{PRIORITY}}
        </span>
        {{/if}}
        <p class="post-description">{{DESCRIPTION}}</p>
        {{#if KEYWORDS}}
        <div class="playbook-keywords">
          {{#each KEYWORDS_ARRAY}}
          <span class="keyword-tag">{{this}}</span>
          {{/each}}
        </div>
        {{/if}}
      </header>

      <div class="post-content">
        {{{CONTENT}}}
      </div>
    </article>

    {{#if RELATED_PLAYBOOKS}}
    <aside class="playbook-related">
      <h2 class="playbook-related-title">Related Playbooks</h2>
      <div class="playbook-related-grid">
        {{{RELATED_PLAYBOOKS_HTML}}}
      </div>
    </aside>
    {{/if}}

    {{#if SAME_CATEGORY_PLAYBOOKS}}
    <aside class="playbook-category-nav">
      <h2 class="playbook-category-title">More {{CATEGORY}} Playbooks</h2>
      <nav class="playbook-category-grid">
        {{{SAME_CATEGORY_PLAYBOOKS_HTML}}}
      </nav>
    </aside>
    {{/if}}
  </main>

  {{{FOOTER}}}

  {{{SCRIPTS}}}

  <!-- Playbook Copy Functionality -->
  <script>
  (function() {
    const btn = document.querySelector('.playbook-copy-btn');
    if (!btn) return;

    btn.addEventListener('click', async function(e) {
      e.preventDefault();
      try {
        const title = document.querySelector('.post-header h1');
        const description = document.querySelector('.post-description');
        const content = document.querySelector('.post-content');

        let markdown = '';
        if (title) markdown += `# ${title.textContent.trim()}\n\n`;
        if (description) markdown += `${description.textContent.trim()}\n\n`;
        if (content) markdown += content.innerText;

        if (markdown) {
          await navigator.clipboard.writeText(markdown);
          this.classList.add('copied');
          setTimeout(() => this.classList.remove('copied'), 2000);
        }
      } catch (error) {
        console.error('Copy failed:', error);
      }
    });
  })();
  </script>
</body>
</html>
